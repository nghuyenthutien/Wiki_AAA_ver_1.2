import os
import re

def fix_links_in_file(filepath):
    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()

    # Regex để tìm các link markdown có dấu cách dư
    fixed_content = re.sub(
        r'\[([^\]]+?)\]\(\s*([^\s\)]+?)\s*\.md\s*\)',  # Match link kiểu có khoảng trắng
        lambda m: f'[{m.group(1)}]({m.group(2).strip()}.md)',  # Sửa lại cho gọn
        content
    )

    with open(filepath, 'w', encoding='utf-8') as f:
        f.write(fixed_content)

def fix_all_md_links_in_directory(directory):
    for root, _, files in os.walk(directory):
        for file in files:
            if file.endswith('.md'):
                filepath = os.path.join(root, file)
                print(f"Đang sửa: {filepath}")
                fix_links_in_file(filepath)

if __name__ == "__main__":
    folder_path = input("Nhập đường dẫn thư mục chứa các file .md: ").strip()
    if os.path.isdir(folder_path):
        fix_all_md_links_in_directory(folder_path)
        print("✅ Đã chuẩn hóa xong các link Markdown.")
    else:
        print("❌ Thư mục không hợp lệ.")
